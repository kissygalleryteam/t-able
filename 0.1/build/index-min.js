/*!build time : 2014-04-23 9:52:52 AM*/
KISSY.add("gallery/t-able/0.1/src/datastore",function(a,b){function c(b,c){this.cfg=a.merge(e,c),this._originData=b,this._parseData(b)}var d="_uid",e={dataIndex:"id"};return a.augment(c,b.Target,{getBody:function(){return this.body},getHead:function(){return this.head},getFoot:function(){return this.foot},getDataByIndex:function(a){return this._indexMap[a]},getDataByUID:function(a){return this._uDataMap[a]},_parseData:function(a){this.head=this._parseHeadData(a.head),this._uDataMap={},this._indexMap={},this.body=this._parseBodyData(a.rows),this.foot=this._parseFootData(a.foot)},deepMix:function(b,c){return a.mix(b,c,void 0,void 0,!0)},_parseHeadData:function(a){return a},_parseBodyData:function(b){var c=this.cfg,e=c.dataIndex,f=this._uDataMap,g=this._indexMap;return a.each(b,function(b){var c=a.guid();f[c]=b,b[d]=c,g[b[e]]=b}),b},_parseFootData:function(a){return a}}),c},{requires:["event"]}),KISSY.add("gallery/t-able/0.1/src/dproxy",function(a,b){var c=b.all,d={bindEvent:function(b){var d=this.__P;d&&a.each(d,function(a){var d=a.selector?c(a.selector,b):b;d.on(a.type,a.fn)})},registerEvent:function(b){if(b){var c=this.__P;c||(c=this.__P=[]),a.each(b,function(a,b){var d=b.match(/^(\w+)\s*(.*)$/);c.push({type:d[1],selector:d[2],fn:a})})}}};return d},{requires:["node"]}),KISSY.add("gallery/t-able/0.1/src/column",function(a,b,c,d,e){function f(b){var c=a.merge(h,b);this.cfg=c,this._parseTemplate(),this.registerEvent(c.events)}var g=b.all,h={},i='<div class="inner-wrap">{html}</div>',j='<table class="inner-table"><tr></tr></table>',k='<td class="inner-cell cell-{name}" width="{width}"></td>';return a.augment(f,c.Target,e,{getColspan:function(){var a=this.columns;return a&&a.length||1},render:function(b,c){var d,e=this.cfg;a.isFunction(e.adapter)&&(b=e.adapter(b)),d=e.nested?this._nestRender(b,c):this._render(b,c),this.fire("afterRender",{$wrap:d})},_nestRender:function(b,c){var d=this,e=g(j),f=e.one("tr");return a.each(this.columns,function(a){f.append(d._createCell(a,b))}),g(c).append(e),e},_render:function(a,b){var c=this.template;if(!c||!a)return"";var e=new d(c).render(a),f=g(e);return g(b).append(f),f},_createCell:function(b,c){var d=g(a.substitute(k,{name:b.name,width:b.width}));return b.render(c,d),b.bindEvent(d),d},_parseTemplate:function(){var c=this.cfg,d=c.template,e=c.width,g=c.caption,h=c.name;if(c.templateId){var j=b.one(c.templateId);j&&(d=j.html(),e||(e=j.attr("data-width")),h||(h=j.attr("data-name")),g||(g=j.attr("data-caption")))}if(!d&&h&&(d="{{"+h+"}}"),c.nested){var k=0;this.columns=a.map(c.columns,function(a){return a instanceof f||(a=new f(a)),k+=a.width,a}),k&&(e=k)}else this.template=a.substitute(i,{html:d});this.caption=g,this.name=h,this.width=e}}),f},{requires:["node","event","xtemplate","./dproxy"]}),KISSY.add("gallery/t-able/0.1/src/header",function(a,b,c,d,e){function f(b){var c=this.cfg=a.merge(g,b);this.registerEvent(c.events)}var g=(b.all,{template:'<tr>{{@each columns}}<th width="{{width}}" colspan="{{colspan&&colspan.length}}">{{caption}}</th>{{/each}}</tr>'});return a.augment(f,c.Target,e,{render:function(b){var c=this.cfg,e=c.template,f=a.merge(c,b);return a.isFunction(c.adapter)&&(f=c.adapter(f)),new d(e).render(f)}}),f},{requires:["node","event","xtemplate","./dproxy"]}),KISSY.add("gallery/t-able/0.1/src/footer",function(a,b,c,d,e){function f(b){var c=this.cfg=a.merge(g,b);this.registerEvent(c.events)}var g=(b.all,{template:""});return a.augment(f,c.Target,e,{render:function(b){var c=this.cfg,e=c.template,f=a.merge(c,b);return a.isFunction(c.adapter)&&(f=c.adapter(f)),new d(e).render(f)}}),f},{requires:["node","event","xtemplate","./dproxy"]}),KISSY.add("gallery/t-able/0.1/src/index",function(a,b,c,d,e,f,g,h){function i(b,c,d){var e=this.cfg=a.merge(l,d);this.$parent=j(e.parent),this.$wrap=j(e.wrap),this._parseColumnsQueueAndMap(b),this._parseData(c),this._parseHead(e.head),this._parseFoot(e.foot)}var j=b.all,k="_uid",l={wrap:'<table class="ta-wrap"><tbody class="ta-body"></tbody></table>',rowTemplate:'<tr class="ta-row" id="ta-row-{_id}" data-id="{_id}"></tr>',cellTemplate:'<td colspan="{colspan}" class="ta-cell cell-{name}" width="{width}"></td>',headTemplate:'<thead class="ta-head"></thead>',footTemplate:'<tfoot class="ta-foot"></tfoot>',emptyTemplate:"<div>\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c\uff01</div>"};return a.augment(i,c.Target,{render:function(){var a=this.dataStore,b=this.$parent;b.html(""),this.renderBody(a.getBody()),this.renderHead(a.getHead()),this.renderFoot(a.getFoot()),b.append(this.$wrap),this.fire("afterRender")},renderBody:function(b){var c=this,d=this.$wrap,e=j(document.createDocumentFragment());0==b.length?e.append(c._createEmptyRow()):a.each(b,function(a){var b=c._createRow(a);e.append(b),c.fire("afterRowRender",{data:a,$row:b})}),d.one("tbody").append(e),this.fire("bodyRender")},renderHead:function(a){var b=this.cfg,c=j(b.headTemplate),d=this.header,e=d.render(a);e&&(c.append(e).appendTo(this.$wrap),d.bindEvent(c)),this.fire("headerRender")},renderFoot:function(a){var b=this.cfg,c=j(b.footTemplate),d=this.footer,e=d.render(a);e&&(c.append(e).appendTo(this.$wrap),d.bindEvent(c)),this.fire("footerRender")},updateRowView:function(a,b){if(a&&b){var c=this.dataStore,d=c.getDataByIndex(a);if(d){var e,f=this.getRowByData(d);f&&(c.deepMix(d,b),e=this._createRow(d),f.replaceWith(e)),this.fire("afterRowUpdate",{data:d,$row:e,$oldRow:f})}}},getRowByData:function(a){var c=a[k],d=b.one("#ta-row-"+c);return void 0!==c&&d?d:null},getColumnByName:function(a){return this.columnsMap[a]},_parseColumnsQueueAndMap:function(b){var c=[],d={};a.each(b,function(a){var b=a;b instanceof f||(b=new f(a)),d[b.name]=b,c.push(b)}),this.columns=c,this.columnsMap=d},_parseData:function(a){var b=a;b instanceof e||(b=new e(a)),this.dataStore=b},_parseHead:function(a){var b=a;b instanceof g||(b=new g(a)),this.header=b},_parseFoot:function(a){var b=a;b instanceof h||(b=new h(a)),this.footer=b},_createRow:function(b){var c=this,d=c.cfg,e=a.substitute(d.rowTemplate,{_id:b[k]}),f=j(e);return a.each(c.columns,function(a){f.append(c._createCell(a,b))}),f},_createCell:function(b,c){var d=this.cfg,e=j(a.substitute(d.cellTemplate,{colspan:b.getColspan(),name:b.name,width:b.width}));return b.render(c,e),b.bindEvent(e),e},_createEmptyRow:function(){var b=a.reduce(this.columns,function(a,b){return a+b.getColspan()},0),c=a.substitute('<tr><td colspan="{colspan}">{html}</td></tr>',{colspan:b,html:this.cfg.emptyTemplate});return j(c)}}),i},{requires:["node","event","xtemplate","./datastore","./column","./header","./footer"]}),KISSY.add("gallery/t-able/0.1/src/pagination",function(a,b,c){function d(b){this.cfg=a.merge(e,b),this.template=this.cfg.template,this.liteTemplate=this.cfg.liteTemplate}var e=(b.all,{pageSize:20,padding:4,template:'<ul class="pagination">{{@if isFirst}}<li class="disabled"><span>&laquo;</span></li>{{else}}<li><a href="javascript:;" class="pn" data-value="{{current-1}}">&laquo;</a></li>{{/if}}{{@each queue}}{{@if type==="digital"}}{{@if value===current}}<li class="active"><span>{{value}}</span></li>{{else}}<li><a class="pn" href="javascript:;" data-value="{{value}}">{{value}}</a></li>{{/if}}{{/if}}{{@if type==="split"}}<li><span>{{value}}</span></li>{{/if}}{{/each}}{{@if isLast}}<li class="disabled"><span>&raquo;</span></li>{{else}}<li><a href="javascript:;" class="pn" data-value="{{current+1}}">&raquo;</a></li>{{/if}}</ul>',liteTemplate:'<ul class="pagination">{{@if isFirst}}<li class="disabled"><span>&laquo; \u4e0a\u4e00\u9875</span></li>{{else}}<li><a href="javascript:;" class="pn" data-value="{{current-1}}">&laquo; \u4e0a\u4e00\u9875</a></li>{{/if}}{{@if isLast}}<li class="disabled"><span>\u4e0b\u4e00\u9875 &raquo;</span></li>{{else}}<li><a href="javascript:;" class="pn" data-value="{{current+1}}">\u4e0b\u4e00\u9875 &raquo;</a></li>{{/if}}</ul>'});return a.augment(d,a.Event.Target,{getHTML:function(a){var b=this.calPageData(a);return new c(this.template).render(b)},getLiteHTML:function(a){var b=this.calPageData(a);return new c(this.liteTemplate).render(b)},jumpTo:function(a){this.fire("jump",{to:a})},calPageData:function(b){var c=a.merge(this.cfg,b),d=1*c.current,e=1*c.totalRecord,f=1*c.pageSize,g=1*c.padding,h=this._getPageData,i=Math.ceil(e/f);1>d&&(d=1),d>i&&(d=i);for(var j=[],k=d-g;d+g>=k;k++)k>=1&&i>=k&&j.push(h("digital",k));if(0===j.length)return{queue:[h("digital",1)],current:1,isFirst:!0,isLast:!0};var l=j[0].value,m=j[j.length-1].value,n=[];l>1&&n.push(h("digital",1)),l>2&&n.push(h("split"));var o=[];return i>m&&o.push(h("digital",i)),i-1>m&&o.unshift(h("split")),{queue:[].concat(n,j,o),current:d,isFirst:1==d,isLast:d==i}},_getPageData:function(a,b){return{type:a,value:b||"..."}}}),d},{requires:["node","xtemplate"]}),KISSY.add("gallery/t-able/0.1/index",function(a,b,c,d,e,f,g){var h=function(a){var c=a.data,d=a.columns;return new b(d,c,a)};return a.mix(h,{Column:d,Footer:f,Header:e,DataStore:c,Pagination:g}),h},{requires:["./src/","./src/datastore","./src/column","./src/header","./src/footer","./src/pagination"]});